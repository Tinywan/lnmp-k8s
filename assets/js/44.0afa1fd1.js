(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{210:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"oci-runtime"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#oci-runtime","aria-hidden":"true"}},[s._v("#")]),s._v(" OCI Runtime")]),s._v(" "),a("ul",[a("li",[s._v("https://kubernetes.io/docs/concepts/containers/runtime-class/")]),s._v(" "),a("li",[s._v("https://github.com/opencontainers/runtime-spec/blob/master/implementations.md")])]),s._v(" "),a("h2",{attrs:{id:"runc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#runc","aria-hidden":"true"}},[s._v("#")]),s._v(" runc")]),s._v(" "),a("ul",[a("li",[s._v("https://github.com/opencontainers/runc")])]),s._v(" "),a("h2",{attrs:{id:"gvisor-runsc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gvisor-runsc","aria-hidden":"true"}},[s._v("#")]),s._v(" gvisor(runsc)")]),s._v(" "),a("ul",[a("li",[s._v("https://github.com/google/gvisor")]),s._v(" "),a("li",[s._v("https://gvisor.dev/docs/user_guide/docker/")])]),s._v(" "),a("h3",{attrs:{id:"在-kubernetes-使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-kubernetes-使用","aria-hidden":"true"}},[s._v("#")]),s._v(" 在 Kubernetes 使用")]),s._v(" "),a("h4",{attrs:{id:"containerd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#containerd","aria-hidden":"true"}},[s._v("#")]),s._v(" Containerd")]),s._v(" "),a("ul",[a("li",[s._v("https://github.com/google/gvisor-containerd-shim")]),s._v(" "),a("li",[s._v("https://github.com/google/gvisor-containerd-shim/blob/master/docs/runtime-handler-shim-v2-quickstart.md")])]),s._v(" "),a("p",[s._v("下载 "),a("code",[s._v("containerd-shim-runsc-v1")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -fsSL -o /usr/local/bin/containerd-shim-runsc-v1 https://github.com/google/gvisor-containerd-shim/releases/download/v0.0.3/containerd-shim-runsc-v1.linux-amd64\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/containerd-shim-runsc-v1\n")])])]),a("p",[a("code",[s._v("/etc/containerd/config.toml")])]),s._v(" "),a("div",{staticClass:"language-toml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-toml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# [plugins.cri.containerd.runtimes.${HANDLER_NAME}]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("plugins.cri.containerd.runtimes.runsc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("runtime_type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.runsc.v1"')]),s._v("\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart containerd\n")])])]),a("h4",{attrs:{id:"cri-o"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cri-o","aria-hidden":"true"}},[s._v("#")]),s._v(" cri-o")]),s._v(" "),a("p",[a("code",[s._v("/etc/crio/crio.conf")])]),s._v(" "),a("div",{staticClass:"language-toml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-toml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# [crio.runtime.runtimes.${HANDLER_NAME}]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("crio.runtime.runtimes.runsc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  runtime_path = "${PATH_TO_BINARY}"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("runtime_path")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/bin/runsc"')]),s._v("\n")])])]),a("h4",{attrs:{id:"使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用","aria-hidden":"true"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),a("p",[s._v("新建 "),a("code",[s._v("runtimeclass")])]),s._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node.k8s.io/v1beta1  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RuntimeClass is defined in the node.k8s.io API group")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RuntimeClass\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myclass  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The name the RuntimeClass will be referenced by")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RuntimeClass is a non-namespaced resource")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# handler: myconfiguration  # The name of the corresponding CRI configuration")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" runsc "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 值与 CRI 配置文件对应 ${HANDLER_NAME}")]),s._v("\n")])])]),a("p",[s._v("使用 "),a("code",[s._v("runtimeclass")])]),s._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mypod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 与 runtimeclass 配置文件的 metadata.name 对应")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runtimeClassName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myclass\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\n")])])]),a("h3",{attrs:{id:"在-docker-中使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-docker-中使用","aria-hidden":"true"}},[s._v("#")]),s._v(" 在 Docker 中使用")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("runsc")]),s._v(" 与 "),a("code",[s._v("Docker")]),s._v(" 的 "),a("code",[s._v("--exec-opt native.cgroupdriver=systemd")]),s._v(" 不兼容。")])]),s._v(" "),a("p",[s._v("下载 "),a("code",[s._v("runsc")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -fsSL https://github.com/docker-practice/gvisor-mirror/releases/download/nightly/runsc-linux-amd64.tar.gz "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -C /usr/local/bin -zxvf -\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /usr/local/bin/runsc\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/runsc\n")])])]),a("p",[s._v("配置 Docker")]),s._v(" "),a("p",[a("code",[s._v("/etc/docker/daemon.json")])]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"runtimes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"runsc"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"path"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/bin/runsc"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("在 Docker 中使用")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ docker run --runtime"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("runsc --rm hello-world\n")])])])])}],!1,null,null,null);t.default=e.exports}}]);