(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{202:function(e,t,s){"use strict";s.r(t);var a=s(0),r=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"kubelet"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubelet","aria-hidden":"true"}},[e._v("#")]),e._v(" Kubelet")]),e._v(" "),s("h2",{attrs:{id:"初始化步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化步骤","aria-hidden":"true"}},[e._v("#")]),e._v(" 初始化步骤")]),e._v(" "),s("ul",[s("li",[e._v("参考 "),s("code",[e._v("bin/generate-kubelet-bootstrap-kubeconfig.sh")])])]),e._v(" "),s("h2",{attrs:{id:"必须手动-approve-server-cert-csr"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#必须手动-approve-server-cert-csr","aria-hidden":"true"}},[e._v("#")]),e._v(" 必须手动 approve server cert csr")]),e._v(" "),s("p",[s("strong",[e._v("基于安全性考虑，CSR approving controllers 默认不会自动 approve kubelet server 证书签名请求，需要手动 approve。")])]),e._v(" "),s("ul",[s("li",[e._v("https://github.com/opsnull/follow-me-install-kubernetes-cluster/issues/326")])]),e._v(" "),s("p",[e._v("未手动 approve 之前报错如下。")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("bootstrap.go:65"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" Using bootstrap kubeconfig to generate TLS client cert, key and kubeconfig "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("file")]),e._v("\n\nbootstrap.go:96"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" No valid private key and/or certificate found, reusing existing private key or creating a new one\n")])])]),s("h3",{attrs:{id:"解决办法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决办法","aria-hidden":"true"}},[e._v("#")]),e._v(" 解决办法")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$ kubectl get csr\n\nNAME                                                   AGE     REQUESTOR                 CONDITION\ncsr-4gzpq                                              4m20s   system:node:node1         Pending\ncsr-62qp7                                              50m     system:node:node1         Pending\ncsr-6ml4w                                              12m     system:node:node1         Pending\ncsr-8nvc2                                              63m     system:node:node1         Pending\ncsr-f6gbd                                              38m     system:node:node1         Pending\ncsr-sjthd                                              25m     system:node:node1         Pending\ncsr-sxjxf                                              2m41s   system:node:node1         Pending\nnode-csr-j1Ja8wpP3FxFBMnEVNsrwYosgWk_-796bWmRg9cnFTE   63m     system:bootstrap:fp7k2i   Approved,Issued\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# approve 倒数第二个，例如")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# $ kubectl certificate approve csr-sxjxf")]),e._v("\n$ kubectl certificate approve CSR_NAME\n\n$ kubectl describe csr CSR_NAME\n")])])]),s("h2",{attrs:{id:"特性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#特性","aria-hidden":"true"}},[e._v("#")]),e._v(" 特性")]),e._v(" "),s("ul",[s("li",[e._v("使用 TLS bootstrap 机制自动生成 client 和 server 证书，过期后自动轮转；")])]),e._v(" "),s("h2",{attrs:{id:"bootstrap-token-auth-和授予权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bootstrap-token-auth-和授予权限","aria-hidden":"true"}},[e._v("#")]),e._v(" Bootstrap Token Auth 和授予权限")]),e._v(" "),s("p",[s("code",[e._v("kublet")]),e._v(" 启动时查找配置的 "),s("code",[e._v("--kubeletconfig")]),e._v(" 文件是否存在，如果不存在则使用 "),s("code",[e._v("--bootstrap-kubeconfig")]),e._v(" 向 "),s("code",[e._v("kube-apiserver")]),e._v(" 发送证书签名请求 (CSR)。")]),e._v(" "),s("p",[e._v("kube-apiserver 收到 CSR 请求后，对其中的 Token 进行认证（事先使用 kubeadm 创建的 token），认证通过后将请求的 user 设置为 system:bootstrap:，group 设置为 system:bootstrappers，这一过程称为 Bootstrap Token Auth。")]),e._v(" "),s("p",[e._v("kubelet 启动后使用 --bootstrap-kubeconfig 向 kube-apiserver 发送 CSR 请求，当这个 CSR 被 approve 后，kube-controller-manager 为 kubelet 创建 TLS 客户端证书、私钥和 --kubeletconfig 文件。")]),e._v(" "),s("h2",{attrs:{id:"pause"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pause","aria-hidden":"true"}},[e._v("#")]),e._v(" pause")]),e._v(" "),s("ul",[s("li",[e._v("https://github.com/rootsongjc/kubernetes-handbook/blob/master/concepts/pause-container.md")])])])}],!1,null,null,null);t.default=r.exports}}]);