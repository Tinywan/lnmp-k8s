(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{225:function(t,e,s){"use strict";s.r(e);var r=s(0),_=Object(r.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),s("p",[t._v("创建一个 PVC 就必须手动去创建一个 PV")]),t._v(" "),s("h2",{attrs:{id:"动态创建-pv"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#动态创建-pv","aria-hidden":"true"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/storage/dynamic-provisioning/",target:"_blank",rel:"noopener noreferrer"}},[t._v("动态创建 PV"),s("OutboundLink")],1)]),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"persistentvolume（持久化卷-pv）"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#persistentvolume（持久化卷-pv）","aria-hidden":"true"}},[this._v("#")]),this._v(" PersistentVolume（持久化卷 PV）")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[e("p",[this._v("https://github.com/kubernetes-incubator/external-storage")])]),this._v(" "),e("li",[e("p",[this._v("PV 是 "),e("strong",[this._v("全局")]),this._v(" 的,没有命名空间的概念。")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ kubectl get storageclass\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("PersistentVolumes")]),t._v(" 可以有多种回收策略，包括 "),s("strong",[t._v("Retain")]),t._v("、"),s("strong",[t._v("Recycle")]),t._v(" 和 "),s("strong",[t._v("Delete")]),t._v("。对于动态配置的 "),s("code",[t._v("PersistentVolumes")]),t._v(" 来说，默认回收策略为 "),s("strong",[t._v("Delete")]),t._v("。这表示当用户删除对应的 "),s("code",[t._v("PersistentVolumeClaim")]),t._v(" 时，动态配置的 volume 将被自动删除。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("如果 volume 包含重要数据时，这种自动行为可能是不合适的。那种情况下，更适合使用 "),s("strong",[t._v("Retain")]),t._v(" 策略。使用 "),s("strong",[t._v("Retain")]),t._v(" 时，如果用户删除 "),s("code",[t._v("PVC")]),t._v("，对应的 "),s("code",[t._v("PV")]),t._v(" 不会被删除。相反，它将变为 "),s("strong",[t._v("Released")]),t._v(" 状态，表示所有的数据可以被手动恢复。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"pv-回收策略"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pv-回收策略","aria-hidden":"true"}},[this._v("#")]),this._v(" PV 回收策略")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("p",[s("strong",[t._v("Retain")]),t._v(" 就是保留现场，K8S 什么也不做，允许人工处理保留的数据")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Delete")]),t._v(" K8S会自动删除该 PV 及里面的数据")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Recycle")]),t._v(" K8S会将 PV 里的数据删除，然后把 PV 的状态变成 Available，又可以被新的 PVC 绑定使用")])]),t._v(" "),s("li",[s("p",[t._v("NFS 和 HostPath 支持回收 "),s("strong",[t._v("Recycle")])])]),t._v(" "),s("li",[s("p",[t._v("AWS、EBS、GCE、PD 和 Cinder 支持删除 "),s("strong",[t._v("Delete")]),t._v("。")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"状态位清除"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#状态位清除","aria-hidden":"true"}},[this._v("#")]),this._v(" 状态位清除")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ kubectl replace -f xxx.yaml "),e("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 定义 PV 的 YAML 文件")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"tips"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tips","aria-hidden":"true"}},[this._v("#")]),this._v(" Tips")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[e("p",[this._v("静态提供：管理员手动创建多个PV，供PVC使用。")])]),this._v(" "),e("li",[e("p",[this._v("动态提供：动态创建PVC特定的PV，并绑定。")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("PVC")]),t._v(" 和 "),s("code",[t._v("PV")]),t._v(" 的绑定，不是简单的通过 "),s("code",[t._v("Label")]),t._v(" 来进行。而是要综合 "),s("code",[t._v("storageClassName")]),t._v(" "),s("code",[t._v("accessModes")]),t._v(" "),s("code",[t._v("matchLabels")]),t._v(" 以及 "),s("code",[t._v("storage")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"静态创建-pv"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#静态创建-pv","aria-hidden":"true"}},[this._v("#")]),this._v(" 静态创建 PV")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("动态存储卷供应使用 "),e("code",[this._v("StorageClass")]),this._v(" 进行实现，其允许存储卷按需被创建。如果没有动态存储供应，Kubernetes 集群的管理员将不得不通过手工的方式类创建新的存储卷。通过动态存储卷，Kubernetes 将能够按照用户的需要，自动创建其需要的存储。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"storageclassname"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#storageclassname","aria-hidden":"true"}},[this._v("#")]),this._v(" storageClassName")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("In the past, the annotation "),e("code",[this._v("volume.beta.kubernetes.io/storage-class")]),this._v(" was used instead of the "),e("code",[this._v("storageClassName")]),this._v(" attribute. This annotation is still working; however, it will become fully deprecated in a future Kubernetes release")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"pv-type"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pv-type","aria-hidden":"true"}},[this._v("#")]),this._v(" PV type")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("https://kubernetes.io/docs/concepts/storage/persistent-volumes/#types-of-persistent-volumes")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"pv-生命周期"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pv-生命周期","aria-hidden":"true"}},[this._v("#")]),this._v(" PV 生命周期")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("available")]),t._v(" 表示当前的 pv 没有被绑定\n"),s("code",[t._v("bound")]),t._v(" 已经被 pvc 挂载\n"),s("code",[t._v("released")]),t._v(" pvc 没有在使用 pv, 需要管理员手工释放 pv\n"),s("code",[t._v("failed")]),t._v(" 资源回收失败")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",[t._v("操作")]),t._v(" "),s("th",[t._v("PV状态")]),t._v(" "),s("th",[t._v("PVC状态")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("1. 添加 PV")]),t._v(" "),s("td",[t._v("Available")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td",[t._v("2. 添加 PVC")]),t._v(" "),s("td",[t._v("Available")]),t._v(" "),s("td",[t._v("Pending")])]),t._v(" "),s("tr",[s("td"),t._v(" "),s("td",[t._v("Bound")]),t._v(" "),s("td",[t._v("Bound")])]),t._v(" "),s("tr",[s("td",[t._v("3. 删除 PV")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("Lost")])]),t._v(" "),s("tr",[s("td",[t._v("4. 再次添加 PV")]),t._v(" "),s("td",[t._v("Bound")]),t._v(" "),s("td",[t._v("Bound")])]),t._v(" "),s("tr",[s("td",[t._v("5. 删除 PVC")]),t._v(" "),s("td",[t._v("Released")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td",[t._v("6. Storage 不可用")]),t._v(" "),s("td",[t._v("Failed")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td",[t._v("7. 手动修改PV，删除 ClaimRef")]),t._v(" "),s("td",[t._v("Available")]),t._v(" "),s("td",[t._v("-")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[this._v("#")]),this._v(" 参考")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("https://www.cnblogs.com/cuishuai/p/9152277.html")])])}],!1,null,null,null);e.default=_.exports}}]);