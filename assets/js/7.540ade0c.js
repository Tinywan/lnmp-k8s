(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{173:function(a,s,t){"use strict";t.r(s);var e=t(0),r=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("div",{staticClass:"content"},[t("h1",{attrs:{id:"dashboard-插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dashboard-插件","aria-hidden":"true"}},[a._v("#")]),a._v(" dashboard 插件")]),a._v(" "),t("ul",[t("li",[a._v("https://github.com/kubernetes/dashboard/tree/v1.10.1/src/deploy/recommended")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ kubectl apply -k addons/dashboard\n\n$ kubectl get all -n kubernetes-dashboard\n")])])]),t("h2",{attrs:{id:"通过-kubectl-proxy-访问-dashboard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过-kubectl-proxy-访问-dashboard","aria-hidden":"true"}},[a._v("#")]),a._v(" 通过 kubectl proxy 访问 dashboard")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ kubectl proxy --address"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'localhost'")]),a._v(" --port"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("8086 --accept-hosts"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'^*$'")]),a._v("\nStarting to serve on 127.0.0.1:8086\n")])])]),t("p",[a._v("http://127.0.0.1:8086/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy")]),a._v(" "),t("h2",{attrs:{id:"创建登录-token"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建登录-token","aria-hidden":"true"}},[a._v("#")]),a._v(" 创建登录 token")]),a._v(" "),t("h3",{attrs:{id:"docker-桌面版"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-桌面版","aria-hidden":"true"}},[a._v("#")]),a._v(" Docker 桌面版")]),a._v(" "),t("ul",[t("li",[a._v("https://github.com/AliyunContainerService/k8s-for-docker-desktop")])]),a._v(" "),t("h4",{attrs:{id:"macos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#macos","aria-hidden":"true"}},[a._v("#")]),a._v(" macOS")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ TOKEN"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("kubectl -n kube-system describe secret default"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("awk")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$1")]),a._v('=="token:"{print '),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$2")]),a._v("}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n\n$ kubectl config set-credentials docker-desktop --token"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${TOKEN}")]),a._v('"')]),a._v("\n")])])]),t("h4",{attrs:{id:"windows"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#windows","aria-hidden":"true"}},[a._v("#")]),a._v(" Windows")]),a._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$TOKEN")]),a._v("="),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("kubectl "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("n kube"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("system describe secret default "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("Select-String")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"token:"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("split "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('" +"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\n$ kubectl config "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("set")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("credentials docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("desktop "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("token="),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${TOKEN}"')]),a._v("\n")])])]),t("p",[t("strong",[a._v("登录 dashboard 的时候选择 kubeconfig 文件")])]),a._v(" "),t("ul",[t("li",[t("p",[t("strong",[a._v("macOS")]),a._v(" "),t("code",[a._v("$HOME/.kube/config")])])]),a._v(" "),t("li",[t("p",[t("strong",[a._v("Windows")]),a._v(" "),t("code",[a._v("%UserProfile%\\.kube\\config")])])])]),a._v(" "),t("h3",{attrs:{id:"linux"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#linux","aria-hidden":"true"}},[a._v("#")]),a._v(" Linux")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ kubectl create sa dashboard-admin -n kube-system\n\n$ kubectl create clusterrolebinding dashboard-admin --clusterrole"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("cluster-admin --serviceaccount"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("kube-system:dashboard-admin\n\n$ ADMIN_SECRET"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("kubectl get secrets -n kube-system "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" dashboard-admin "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("awk")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{print "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$1")]),a._v("}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# dashboard-admin-token-nzlbv")]),a._v("\n\n$ DASHBOARD_LOGIN_TOKEN"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("kubectl describe secret -n kube-system $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("ADMIN_SECRET"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" -E "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'^token'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("awk")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{print "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$2")]),a._v("}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${DASHBOARD_LOGIN_TOKEN}")]),a._v("\n")])])]),t("h2",{attrs:{id:"创建使用-token-的-kubeconfig-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建使用-token-的-kubeconfig-文件","aria-hidden":"true"}},[a._v("#")]),a._v(" 创建使用 token 的 KubeConfig 文件")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置集群参数")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Docker desktop k8s")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# $ export KUBE_APISERVER=https://localhost:6445")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# $ export K8S_ROOT=/opt/k8s")]),a._v("\n\n$ kubectl config set-cluster kubernetes \\\n  --certificate-authority"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${K8S_ROOT:-/opt/k8s}")]),a._v("/certs/ca.pem \\\n  --embed-certs"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true \\\n  --server"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${KUBE_APISERVER:-https://192.168.57.110:6443}")]),a._v(" \\\n  --kubeconfig"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$HOME")]),a._v("/.kube/dashboard.kubeconfig\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置客户端认证参数，使用上面创建的 Token")]),a._v("\n$ kubectl config set-credentials dashboard_user \\\n  --token"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${DASHBOARD_LOGIN_TOKEN}")]),a._v(" \\\n  --kubeconfig"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$HOME")]),a._v("/.kube/dashboard.kubeconfig\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置上下文参数")]),a._v("\n$ kubectl config set-context default \\\n  --cluster"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("kubernetes \\\n  --user"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("dashboard_user \\\n  --kubeconfig"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$HOME")]),a._v("/.kube/dashboard.kubeconfig\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置默认上下文")]),a._v("\n$ kubectl config use-context default --kubeconfig"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$HOME")]),a._v("/.kube/dashboard.kubeconfig\n")])])])])}],!1,null,null,null);s.default=r.exports}}]);