(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{328:function(s,t,a){"use strict";a.r(t);var e=a(33),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"dashboard-插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dashboard-插件"}},[s._v("#")]),s._v(" dashboard 插件")]),s._v(" "),a("ul",[a("li",[s._v("https://github.com/kubernetes/dashboard/blob/master/aio/deploy/recommended.yaml")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ kubectl apply -k addons/dashboard\n\n$ kubectl get all -n kubernetes-dashboard\n")])])]),a("h2",{attrs:{id:"通过-kubectl-proxy-访问-dashboard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过-kubectl-proxy-访问-dashboard"}},[s._v("#")]),s._v(" 通过 kubectl proxy 访问 dashboard")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ kubectl proxy --address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" --port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8086")]),s._v(" --accept-hosts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^*$'")]),s._v("\nStarting to serve on "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:8086\n")])])]),a("p",[s._v("http://127.0.0.1:8086/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy")]),s._v(" "),a("h2",{attrs:{id:"创建登录-token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建登录-token"}},[s._v("#")]),s._v(" 创建登录 token")]),s._v(" "),a("h3",{attrs:{id:"docker-桌面版"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-桌面版"}},[s._v("#")]),s._v(" Docker 桌面版")]),s._v(" "),a("ul",[a("li",[s._v("https://github.com/AliyunContainerService/k8s-for-docker-desktop")])]),s._v(" "),a("p",[a("strong",[s._v("macOS")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TOKEN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl -n kube-system describe secret default"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('=="token:"{print '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n$ kubectl config set-credentials docker-desktop --token"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TOKEN}")]),s._v('"')]),s._v("\n")])])]),a("p",[a("strong",[s._v("Windows")])]),s._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TOKEN")]),s._v("="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n kube"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system describe secret default "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Select-String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"token:"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("split "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" +"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n$ kubectl config "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("credentials docker"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("desktop "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("token="),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${TOKEN}"')]),s._v("\n")])])]),a("p",[a("strong",[s._v("登录 dashboard 的时候选择 kubeconfig 文件")])]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("macOS")]),s._v(" "),a("code",[s._v("$HOME/.kube/config")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("Windows")]),s._v(" "),a("code",[s._v("%UserProfile%\\.kube\\config")])])])]),s._v(" "),a("h3",{attrs:{id:"自行部署的-kubernetes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自行部署的-kubernetes"}},[s._v("#")]),s._v(" 自行部署的 Kubernetes")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ kubectl create sa dashboard-admin -n kube-system\n\n$ kubectl create clusterrolebinding dashboard-admin --clusterrole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cluster-admin --serviceaccount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kube-system:dashboard-admin\n\n$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ADMIN_SECRET")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get secrets -n kube-system "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" dashboard-admin "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PS> $ADMIN_SECRET=(kubectl get secrets -n kube-system | select-string -Pattern dashboard-admin).line.split(' ')[0]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dashboard-admin-token-nzlbv")]),s._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DASHBOARD_LOGIN_TOKEN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl describe secret -n kube-system $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("ADMIN_SECRET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -E "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^token'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PS> $DASHBOARD_LOGIN_TOKEN=(kubectl describe secret -n kube-system ${ADMIN_SECRET} | select-string token:).Line.split(':')[1].trim()")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DASHBOARD_LOGIN_TOKEN}")]),s._v("\n")])])]),a("h2",{attrs:{id:"创建使用-token-的-kubeconfig-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建使用-token-的-kubeconfig-文件"}},[s._v("#")]),s._v(" 创建使用 token 的 KubeConfig 文件")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置集群参数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Docker desktop k8s")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $ export KUBE_APISERVER=https://localhost:6445")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $ export K8S_ROOT=/opt/k8s")]),s._v("\n\n$ kubectl config set-cluster kubernetes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --certificate-authority"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${K8S_ROOT"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k8s}")]),s._v("/etc/kubernetes/pki/ca.pem "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --embed-certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KUBE_APISERVER"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("192.168.57.110"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("6443}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --kubeconfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/dashboard.kubeconfig\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置客户端认证参数，使用上面创建的 Token")]),s._v("\n$ kubectl config set-credentials dashboard_user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --token"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DASHBOARD_LOGIN_TOKEN}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --kubeconfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/dashboard.kubeconfig\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置上下文参数")]),s._v("\n$ kubectl config set-context default "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dashboard_user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --kubeconfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/dashboard.kubeconfig\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置默认上下文")]),s._v("\n$ kubectl config use-context default --kubeconfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/dashboard.kubeconfig\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);