(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{219:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._m(6),t._v(" "),t._m(7),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),t._m(16),t._v(" "),t._m(17),t._m(18),t._v(" "),t._m(19),t._m(20),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._m(24),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),t._m(28),t._v(" "),t._m(29),t._v(" "),s("p",[t._v("执行成功会输出")]),t._v(" "),t._m(30),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._v(" "),s("p",[t._v("由于未部署 CNI 插件，CoreDNS 未正常启动。")]),t._v(" "),t._m(37),t._v(" "),t._m(38),t._v(" "),s("p",[t._v("检查 podCIDR 设置")]),t._v(" "),t._m(39),t._m(40),t._m(41),t._v(" "),t._m(42),t._v(" "),t._m(43),t._v(" "),s("p",[t._v("有 "),s("a",{attrs:{href:"https://docs.projectcalico.org/v3.10/getting-started/kubernetes/installation/calico",target:"_blank",rel:"noopener noreferrer"}},[t._v("三种方式"),s("OutboundLink")],1),t._v(" 存储 calico 数据,这里采用第一种 "),s("code",[t._v("Installing with the Kubernetes API datastore—50 nodes or less")])]),t._v(" "),t._m(44),t._v(" "),t._m(45),t._m(46),t._v(" "),t._m(47),t._v(" "),t._m(48),t._m(49),t._v(" "),t._m(50),s("p",[t._v("不进行以上步骤的话,会报如下错误")]),t._v(" "),t._m(51),t._m(52),t._v(" "),t._m(53),t._m(54),t._v(" "),t._m(55),t._v(" "),t._m(56),t._v(" "),t._m(57),t._m(58),s("p",[t._v("加载内核模块(手动加载，实际上已通过 systemd 的配置执行了加载命令，这里介绍一下原理)")]),t._v(" "),t._m(59),s("p",[t._v("开机自动加载内核模块(Ubuntu)")]),t._v(" "),t._m(60),s("p",[t._v("CentOS 系列请参考 https://blog.csdn.net/s1234567_89/article/details/51836344")]),t._v(" "),t._m(61),t._v(" "),t._m(62),t._m(63),t._v(" "),t._m(64),t._v(" "),t._m(65),t._v(" "),t._m(66),t._m(67),t._v(" "),t._m(68),t._m(69),t._v(" "),t._m(70),t._v(" "),t._m(71),t._v(" "),t._m(72),t._m(73),t._v(" "),t._m(74),t._m(75),t._v(" "),t._m(76),t._v(" "),t._m(77),t._m(78),t._m(79),t._v(" "),t._m(80),t._m(81),t._v(" "),t._m(82),t._v(" "),t._m(83),t._v(" "),t._m(84)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"kubeadm-部署-kubernetes-基于-1-16-x"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kubeadm-部署-kubernetes-基于-1-16-x","aria-hidden":"true"}},[this._v("#")]),this._v(" kubeadm 部署 kubernetes(基于 1.16.x)")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("p",[t._v("https://github.com/kubernetes/kubeadm")])]),t._v(" "),s("li",[s("p",[t._v("https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/")])]),t._v(" "),s("li",[s("p",[t._v("https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init/")])]),t._v(" "),s("li",[s("p",[t._v("https://docs.khs1994.com/feiskyer-kubernetes-handbook/deploy/kubeadm.html")])]),t._v(" "),s("li",[s("p",[t._v("https://blog.csdn.net/tiger435/article/details/85002337")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"安装-kubelet-kubeadm-kubectl"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装-kubelet-kubeadm-kubectl","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装 "),e("strong",[this._v("kubelet")]),this._v(" "),e("strong",[this._v("kubeadm")]),this._v(" "),e("strong",[this._v("kubectl")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("手动下载二进制文件放入 PATH，或者使用包管理工具安装。下面介绍如何使用包管理工具安装")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"ubuntu-debian"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-debian","aria-hidden":"true"}},[this._v("#")]),this._v(" Ubuntu/Debian")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y apt-transport-https\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" apt-key "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" -\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v("EOF "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" /etc/apt/sources.list.d/kubernetes.list\ndeb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\nEOF\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y kubelet kubeadm kubectl\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"centos-fedora"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#centos-fedora","aria-hidden":"true"}},[this._v("#")]),this._v(" CentOS/Fedora")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v("EOF "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" /etc/yum.repos.d/kubernetes.repo\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubernetes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nname"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Kubernetes\nbaseurl"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1\ngpgcheck"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1\nrepo_gpgcheck"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1\ngpgkey"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n\n$ setenforce 0\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y kubelet kubeadm kubectl\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"修改内核的运行参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改内核的运行参数","aria-hidden":"true"}},[this._v("#")]),this._v(" 修改内核的运行参数")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("https://kubernetes.io/docs/setup/production-environment/container-runtimes/")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ sysctl -a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" net.*iptables\n\nnet.bridge.bridge-nf-call-iptables "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 1\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 若未输出以上结果，请执行以下命令，若正常输出，请跳过以下命令")]),t._v("\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v("EOF "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" /etc/sysctl.d/99-kubernetes-cri.conf\nnet.bridge.bridge-nf-call-iptables  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 1\nnet.ipv4.ip_forward                 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 1\nnet.bridge.bridge-nf-call-ip6tables "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 1\nEOF\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 应用配置")]),t._v("\n$ sysctl --system\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"配置-kubelet"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-kubelet","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置 kubelet")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"修改-kubelet-service-使用包管理工具安装-kubeadm-请跳过此步，查看下一步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改-kubelet-service-使用包管理工具安装-kubeadm-请跳过此步，查看下一步骤","aria-hidden":"true"}},[this._v("#")]),this._v(" 修改 "),e("code",[this._v("kubelet.service")]),this._v(" (使用包管理工具安装 kubeadm 请跳过此步，查看下一步骤)")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("sudo")]),this._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("mkdir")]),this._v(" -p /etc/systemd/system/kubelet.service.d\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("/etc/systemd/system/kubelet.service.d/10-kubeadm.conf")]),this._v(" 写入以下内容(内容来自包管理工具安装的 kubeadm)")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Note: This dropin only works with kubeadm and kubelet v1.11+")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nEnvironment"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf"')]),t._v("\nEnvironment"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# This is a file that "kubeadm init" and "kubeadm join" generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically')]),t._v("\nEnvironmentFile"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-/var/lib/kubelet/kubeadm-flags.env\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.")]),t._v("\nEnvironmentFile"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-/etc/sysconfig/kubelet\nExecStart"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\nExecStart"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/bin/kubelet "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$KUBELET_KUBECONFIG_ARGS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$KUBELET_CONFIG_ARGS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$KUBELET_KUBEADM_ARGS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$KUBELET_EXTRA_ARGS")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("/etc/systemd/system/kubelet.service.d/10-proxy-ipvs.conf")]),this._v(" 写入以下内容")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用 ipvs 相关内核模块，用于 kube-proxy")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nExecStartPre"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-modprobe ip_vs\nExecStartPre"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-modprobe ip_vs_rr\nExecStartPre"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-modprobe ip_vs_wrr\nExecStartPre"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-modprobe ip_vs_sh\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("/etc/systemd/system/kubelet.service")]),this._v(" 写入以下内容")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Unit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nDescription"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("kubelet: The Kubernetes Node Agent\nDocumentation"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://kubernetes.io/docs/\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nExecStart"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/bin/kubelet\nRestart"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("always\nStartLimitInterval"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("0\nRestartSec"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("10\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Install"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nWantedBy"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("multi-user.target\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 应用配置")]),this._v("\n\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("sudo")]),this._v(" systemctl daemon-reload\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"修改-kubelet-service-使用包管理工具安装-kubeadm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改-kubelet-service-使用包管理工具安装-kubeadm","aria-hidden":"true"}},[this._v("#")]),this._v(" 修改 "),e("code",[this._v("kubelet.service")]),this._v(" (使用包管理工具安装 kubeadm)")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("/etc/systemd/system/kubelet.service.d/10-proxy-ipvs.conf")]),this._v(" 写入以下内容")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用 ipvs 相关内核模块，用于 kube-proxy")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nExecStartPre"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-modprobe ip_vs\nExecStartPre"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-modprobe ip_vs_rr\nExecStartPre"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-modprobe ip_vs_wrr\nExecStartPre"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-modprobe ip_vs_sh\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 应用配置")]),this._v("\n\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("sudo")]),this._v(" systemctl daemon-reload\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署","aria-hidden":"true"}},[this._v("#")]),this._v(" 部署")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"master"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#master","aria-hidden":"true"}},[this._v("#")]),this._v(" master")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("sudo")]),this._v(" kubeadm init --image-repository gcr.azk8s.cn/google-containers \\\n      --pod-network-cidr 10.244.0.0/16 \\\n      --v 5 \\\n      --ignore-preflight-errors"),e("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("all\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("code",[t._v("--pod-network-cidr 10.244.0.0/16")]),t._v(" 参数与后续 CNI 插件有关，这里以 "),s("code",[t._v("flannel")]),t._v(" 为例，若后续部署其他类型的网络插件请更改此参数。")]),t._v(" "),s("li",[t._v("使用 "),s("strong",[t._v("配置文件")]),t._v(" 的方式这里不再赘述")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("执行可能出现错误，例如缺少依赖包，根据提示安装即可。")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("addons"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Applied essential addon: CoreDNS\nI1116 12:35:13.270407   86677 request.go:538"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Throttling request took 181.409184ms, request: POST:https://192.168.199.100:6443/api/v1/namespaces/kube-system/serviceaccounts\nI1116 12:35:13.470292   86677 request.go:538"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Throttling request took 186.088112ms, request: POST:https://192.168.199.100:6443/api/v1/namespaces/kube-system/configmaps\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("addons"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HOME")]),t._v("/.kube\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -i /etc/kubernetes/admin.conf "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HOME")]),t._v("/.kube/config\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -u"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -g"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HOME")]),t._v("/.kube/config\n\nYou should now deploy a pod network to the cluster.\nRun "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubectl apply -f [podnetwork].yaml"')]),t._v(" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" any number of worker nodes by running the following on each as root:\n\nkubeadm "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" 192.168.199.100:6443 --token cz81zt.orsy9gm9v649e5lf \\\n    --discovery-token-ca-cert-hash sha256:5edb316fd0d8ea2792cba15cdf1c899a366f147aa03cba52d4e5c5884ad836fe\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"node-工作节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#node-工作节点","aria-hidden":"true"}},[this._v("#")]),this._v(" node 工作节点")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("在 "),e("strong",[this._v("另一主机")]),this._v(" 重复 "),e("strong",[this._v("部署")]),this._v(" 小节以前的步骤，安装配置好 kubelet。根据提示，加入到集群。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ kubeadm "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("join")]),this._v(" 192.168.199.100:6443 --token cz81zt.orsy9gm9v649e5lf \\\n    --discovery-token-ca-cert-hash sha256:5edb316fd0d8ea2792cba15cdf1c899a366f147aa03cba52d4e5c5884ad836fe\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("将 "),e("code",[this._v("/etc/kubernetes/admin.conf")]),this._v(" 复制到 "),e("code",[this._v("~/.kube/config")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("执行 "),e("code",[this._v("$ kubectl get all -A")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"部署-cni-以下任选其一"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署-cni-以下任选其一","aria-hidden":"true"}},[this._v("#")]),this._v(" 部署 CNI (以下任选其一)")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"flanneld-0-11-0"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#flanneld-0-11-0","aria-hidden":"true"}},[this._v("#")]),this._v(" flanneld (0.11.0)")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ kubectl get node -o yaml "),e("span",{pre:!0,attrs:{class:"token operator"}},[this._v("|")]),this._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("grep")]),this._v(" CIDR\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 输出")]),this._v("\n    podCIDR: 10.244.0.0/24\n    podCIDRs:\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ kubectl apply -k addons/cni/flannel\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"calico-3-10"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#calico-3-10","aria-hidden":"true"}},[this._v("#")]),this._v(" calico (3.10)")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("https://docs.projectcalico.org/v3.10/getting-started/kubernetes/installation/calico")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("修改 "),s("code",[t._v("addons/cni/calico/configMap.yaml")]),t._v(" 中的 "),s("code",[t._v("192.168.0.0/16")]),t._v(" 为 "),s("code",[t._v("10.244.0.0/16")]),t._v("(同 "),s("code",[t._v("flannel")]),t._v(" 一致)")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"删除-flannel"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#删除-flannel","aria-hidden":"true"}},[this._v("#")]),this._v(" 删除 "),e("code",[this._v("flannel")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ kubectl delete -k addons/cni/flannel\n\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("sudo")]),this._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("ip")]),this._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("link")]),this._v(" del flannel.1\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"修改内核参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改内核参数","aria-hidden":"true"}},[this._v("#")]),this._v(" 修改内核参数")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("/etc/sysctl.d/99-kubernetes-calico.conf")]),this._v(" 写入以下内容")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("net.ipv4.conf.all.rp_filter "),e("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v(" 1\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("Fedora 31 默认值为 2 ,其他系统通过 "),e("code",[this._v("sysctl -a | grep net.ipv4.conf.all.rp_filter")]),this._v(" 查看")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 应用配置")]),this._v("\n\n$ sysctl --system\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("2019-11-17 03:23:02.084 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("FATAL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("5336"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" int_dataplane.go 1032: Kernel"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s RPF check is set to '")]),t._v("loose"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.  This would allow endpoints to spoof their IP address.  Calico requires net.ipv4.conf.all.rp_filter to be set to 0 or 1. If you require loose RPF and you are not concerned about spoofing, this check can be disabled by setting the IgnoreLooseRPF configuration parameter to '")]),t._v("true'.\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"部署-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 部署")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ kubectl apply -k addons/cni/calico\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"kube-proxy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kube-proxy","aria-hidden":"true"}},[this._v("#")]),this._v(" kube-proxy")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("https://github.com/kubernetes/kubernetes/blob/master/pkg/proxy/ipvs/README.md")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("启用 "),e("code",[this._v("ipvs")]),this._v(" 模式")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ kubectl edit cm kube-proxy -n kube-system\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-diff extra-class"},[e("pre",{pre:!0,attrs:{class:"language-diff"}},[e("code",[e("span",{pre:!0,attrs:{class:"token deleted"}},[this._v('- mode: ""')]),this._v("\n"),e("span",{pre:!0,attrs:{class:"token inserted"}},[this._v('+ mode: "ipvs"')]),this._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 根据 kube-proxy 日志，查看未加载模块")]),t._v("\n$ E1116 12:53:34.421604       1 server_others.go:339"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" can't determine whether to use ipvs proxy, error: IPVS proxier will not be used because the following required kernel modules are not loaded: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ip_vs_rr ip_vs_wrr ip_vs_sh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n$ modprobe -- ip_vs\n$ modprobe -- ip_vs_rr\n$ modprobe -- ip_vs_wrr\n$ modprobe -- ip_vs_sh\n\n$ modprobe -- nf_conntrack_ipv4\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# linux 内核 4.19+")]),t._v("\n$ modprobe -- nf_conntrack\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v("EOF "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" /etc/modules\nip_vs\nip_vs_rr\nip_vs_wrr\nip_vs_sh\nEOF\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("重启 "),e("code",[this._v("kube-proxy")]),this._v(" (注意将 XXX 替换为自己的名称)")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ kubectl get pod -n kube-system\n\n$ kubectl get pod/kube-proxy-XXX -n kube-system -o yaml "),e("span",{pre:!0,attrs:{class:"token operator"}},[this._v("|")]),this._v(" kubectl replace --force -f -\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"master-节点默认不能运行-pod"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#master-节点默认不能运行-pod","aria-hidden":"true"}},[this._v("#")]),this._v(" master 节点默认不能运行 pod")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("https://blog.csdn.net/BigData_Mining/article/details/88683459")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("也就是说如果用 "),e("code",[this._v("kubeadm")]),this._v(" 部署一个单节点集群不能使用,请执行以下命令")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ kubectl taint nodes --all node-role.kubernetes.io/master-\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 恢复默认值")]),this._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# $ kubectl taint nodes NODE_NAME node-role.kubernetes.io/master=true:NoSchedule")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"高可用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#高可用","aria-hidden":"true"}},[this._v("#")]),this._v(" 高可用")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" kubeadm init --apiserver-cert-extra-sans"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx.com --control-plane-endpoint"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx.com:6443 其他参数\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" kubeadm "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" --control-plane 其他参数\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("高可用，入口地址不能为 IP(127.0.0.1 NGINX 轮询除外，这里不做介绍) 必须为一个域名,"),e("code",[this._v("init")]),this._v(" 时必须指定 "),e("code",[this._v("--apiserver-cert-extra-sans=xxx.com")]),this._v(" "),e("code",[this._v("--control-plane-endpoint=xxx.com:6443")]),this._v("。通过 DNS 轮询 xxx.com 实现高可用(请自行搭建 DNS 服务器，这里不做介绍)")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"附录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#附录","aria-hidden":"true"}},[this._v("#")]),this._v(" 附录")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("使用包管理工具安装的 "),e("code",[this._v("kubeadm")]),this._v(" 增加了哪些文件")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ yum "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("install")]),this._v(" yum-utils -y\n$ yumdownloader kubeadm\n$ rpm2cpio xxx.rpm "),e("span",{pre:!0,attrs:{class:"token operator"}},[this._v("|")]),this._v(" cpio -div\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("新增了 "),e("code",[this._v("/usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf")]),this._v(" 文件")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Note: This dropin only works with kubeadm and kubelet v1.11+")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nEnvironment"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf"')]),t._v("\nEnvironment"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# This is a file that "kubeadm init" and "kubeadm join" generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically')]),t._v("\nEnvironmentFile"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-/var/lib/kubelet/kubeadm-flags.env\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.")]),t._v("\nEnvironmentFile"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-/etc/sysconfig/kubelet\nExecStart"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\nExecStart"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/bin/kubelet "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$KUBELET_KUBECONFIG_ARGS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$KUBELET_CONFIG_ARGS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$KUBELET_KUBEADM_ARGS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$KUBELET_EXTRA_ARGS")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"kubeadm-配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kubeadm-配置文件","aria-hidden":"true"}},[this._v("#")]),this._v(" kubeadm 配置文件")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("https://godoc.org/k8s.io/kubernetes/cmd/kubeadm/app/apis/kubeadm/v1beta2")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 生成默认的配置文件")]),this._v("\n\n$ kubeadm config print init-defaults\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 使用")]),this._v("\n\n$ kubeadm --config 配置文件名 其他参数\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"所需镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#所需镜像","aria-hidden":"true"}},[this._v("#")]),this._v(" 所需镜像")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ kubeadm config images list\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"使用其他运行时"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用其他运行时","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用其他运行时")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("~/lnmp/kubernetes/kubeadm")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"笔者总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#笔者总结","aria-hidden":"true"}},[this._v("#")]),this._v(" 笔者总结")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("关键在于配置好 "),s("code",[t._v("kubelet")])]),t._v(" "),s("li",[t._v("k8s 组件除了 "),s("code",[t._v("kubelet")]),t._v(" 其他组件都能够以 "),s("code",[t._v("pod")]),t._v(" 方式运行，秘诀在于使用了 "),s("code",[t._v("hostnetwork")])]),t._v(" "),s("li",[t._v("国内网络问题（拉取不到 "),s("code",[t._v("k8s.gcr.io")]),t._v(" 镜像）：加上参数 "),s("code",[t._v("--image-repository gcr.azk8s.cn/google-containers")]),t._v(" 解决")]),t._v(" "),s("li",[s("code",[t._v("kubelet")]),t._v(" 的参数 "),s("code",[t._v("--cgroup-driver=systemd")]),t._v(" 一定要与 Docker 的一致，其他文档有介绍，这里不再赘述")])])}],!1,null,null,null);e.default=n.exports}}]);