<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Metrics Server | K8s LNMP</title>
    <meta name="description" content="Run LNMP On K8s">
    <undefined></undefined>
    
    <link rel="preload" href="/assets/css/0.styles.7661f395.css" as="style"><link rel="preload" href="/assets/js/app.782518ec.js" as="script"><link rel="preload" href="/assets/js/9.cba53891.js" as="script"><link rel="prefetch" href="/assets/js/10.ad131b99.js"><link rel="prefetch" href="/assets/js/11.0c1ce695.js"><link rel="prefetch" href="/assets/js/12.ddaac32d.js"><link rel="prefetch" href="/assets/js/13.feb124be.js"><link rel="prefetch" href="/assets/js/14.29b432f7.js"><link rel="prefetch" href="/assets/js/15.7d7f4ffd.js"><link rel="prefetch" href="/assets/js/16.965f5e78.js"><link rel="prefetch" href="/assets/js/17.cb032e7a.js"><link rel="prefetch" href="/assets/js/18.ed3f8d4c.js"><link rel="prefetch" href="/assets/js/19.fc9d0ce8.js"><link rel="prefetch" href="/assets/js/2.bf64c2f6.js"><link rel="prefetch" href="/assets/js/20.6530b76c.js"><link rel="prefetch" href="/assets/js/21.5984ffad.js"><link rel="prefetch" href="/assets/js/22.6eb9b422.js"><link rel="prefetch" href="/assets/js/23.3dbd8802.js"><link rel="prefetch" href="/assets/js/24.e29ad1c0.js"><link rel="prefetch" href="/assets/js/25.90fe8169.js"><link rel="prefetch" href="/assets/js/26.d0cd838f.js"><link rel="prefetch" href="/assets/js/27.edb891e2.js"><link rel="prefetch" href="/assets/js/28.8788b24d.js"><link rel="prefetch" href="/assets/js/29.1a83cd79.js"><link rel="prefetch" href="/assets/js/3.2e90878f.js"><link rel="prefetch" href="/assets/js/30.8e9b2f29.js"><link rel="prefetch" href="/assets/js/31.455da751.js"><link rel="prefetch" href="/assets/js/32.af8c7c10.js"><link rel="prefetch" href="/assets/js/33.fdaf50a5.js"><link rel="prefetch" href="/assets/js/34.7e43958c.js"><link rel="prefetch" href="/assets/js/35.ca8c5796.js"><link rel="prefetch" href="/assets/js/36.f4ef9934.js"><link rel="prefetch" href="/assets/js/37.a03be3d5.js"><link rel="prefetch" href="/assets/js/38.c14e2bb6.js"><link rel="prefetch" href="/assets/js/39.79687e76.js"><link rel="prefetch" href="/assets/js/4.0154d51a.js"><link rel="prefetch" href="/assets/js/40.419e4a3d.js"><link rel="prefetch" href="/assets/js/41.81ce9653.js"><link rel="prefetch" href="/assets/js/42.1e475871.js"><link rel="prefetch" href="/assets/js/43.5e11c722.js"><link rel="prefetch" href="/assets/js/44.378d3cca.js"><link rel="prefetch" href="/assets/js/45.6472938b.js"><link rel="prefetch" href="/assets/js/5.79b4c071.js"><link rel="prefetch" href="/assets/js/6.056ce679.js"><link rel="prefetch" href="/assets/js/7.96bdaf58.js"><link rel="prefetch" href="/assets/js/8.5d00336f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7661f395.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">K8s LNMP</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">教程</a></div><div class="nav-item"><a href="/addons/" class="nav-link router-link-active">插件</a></div><div class="nav-item"><a href="/log/" class="nav-link">日志</a></div><div class="nav-item"><a href="/volume/" class="nav-link">数据卷</a></div><div class="nav-item"><a href="/node/" class="nav-link">工作节点</a></div><div class="nav-item"><a href="https://github.com/khs1994-docker/lnmp-k8s" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://khs1994.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  khs1994.com
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://cloud.tencent.com/redirect.php?redirect=10058&amp;cps_key=3a5255852d5db99dcd5da4c72f05df61" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Kubernetes 免费实验室
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">教程</a></div><div class="nav-item"><a href="/addons/" class="nav-link router-link-active">插件</a></div><div class="nav-item"><a href="/log/" class="nav-link">日志</a></div><div class="nav-item"><a href="/volume/" class="nav-link">数据卷</a></div><div class="nav-item"><a href="/node/" class="nav-link">工作节点</a></div><div class="nav-item"><a href="https://github.com/khs1994-docker/lnmp-k8s" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://khs1994.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  khs1994.com
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://cloud.tencent.com/redirect.php?redirect=10058&amp;cps_key=3a5255852d5db99dcd5da4c72f05df61" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Kubernetes 免费实验室
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/addons/coredns.html" class="sidebar-link">CoreDNS 插件</a></li><li><a href="/addons/dashboard.html" class="sidebar-link">dashboard 插件</a></li><li><a href="/addons/efk.html" class="sidebar-link">EFK 插件</a></li><li><a href="/addons/metrics-server.html" class="active sidebar-link">Metrics Server</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/addons/metrics-server.html#错误排查" class="sidebar-link">错误排查</a></li><li class="sidebar-sub-header"><a href="/addons/metrics-server.html#启动参数" class="sidebar-link">启动参数</a></li></ul></li><li><a href="/addons/prometheus-operator.html" class="sidebar-link">Prometheus Operator</a></li><li><a href="/addons/registry.html" class="sidebar-link">Registry</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="metrics-server"><a href="#metrics-server" aria-hidden="true" class="header-anchor">#</a> Metrics Server</h1> <blockquote><p>本文基于 0.3.x 版本。</p></blockquote> <ul><li>https://github.com/kubernetes-incubator/metrics-server/tree/master/deploy/1.8%2B</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ kubectl apply -f addons/metrics-server
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>$ kubectl <span class="token function">top</span> node

$ kubectl <span class="token function">top</span> pod -A
</code></pre></div><h2 id="错误排查"><a href="#错误排查" aria-hidden="true" class="header-anchor">#</a> 错误排查</h2> <p>无法解析节点的主机名，是 metrics-server 这个容器不能通过 CoreDNS 解析各 Node 的主机名，metrics-server 连节点时默认是连接节点的主机名，需要加个参数，让它连接节点的IP，同时因为 10250 是https端口，连接它时需要提供证书，所以加上 --kubelet-insecure-tls，表示不验证客户端证书，此前的版本中使用 --source= 这个参数来指定不验证客户端证书。</p> <ul><li>https://blog.csdn.net/zyl290760647/article/details/83041991</li> <li>https://www.cnblogs.com/both/p/10078316.html</li></ul> <h2 id="启动参数"><a href="#启动参数" aria-hidden="true" class="header-anchor">#</a> 启动参数</h2> <blockquote><p>0.3.1</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>Launch metrics-server

Usage:
   <span class="token punctuation">[</span>flags<span class="token punctuation">]</span>

Flags:
      --alsologtostderr                                         log to standard error as well as files
      --authentication-kubeconfig string                        kubeconfig <span class="token function">file</span> pointing at the <span class="token string">'core'</span> kubernetes server with enough rights to create tokenaccessreviews.authentication.k8s.io.
      --authentication-skip-lookup                              If false, the authentication-kubeconfig will be used to lookup missing authentication configuration from the cluster.
      --authentication-token-webhook-cache-ttl duration         The duration to cache responses from the webhook token authenticator. <span class="token punctuation">(</span>default 10s<span class="token punctuation">)</span>
      --authorization-kubeconfig string                         kubeconfig <span class="token function">file</span> pointing at the <span class="token string">'core'</span> kubernetes server with enough rights to create  subjectaccessreviews.authorization.k8s.io.
      --authorization-webhook-cache-authorized-ttl duration     The duration to cache <span class="token string">'authorized'</span> responses from the webhook authorizer. <span class="token punctuation">(</span>default 10s<span class="token punctuation">)</span>
      --authorization-webhook-cache-unauthorized-ttl duration   The duration to cache <span class="token string">'unauthorized'</span> responses from the webhook authorizer. <span class="token punctuation">(</span>default 10s<span class="token punctuation">)</span>
      --bind-address <span class="token function">ip</span>                                         The IP address on <span class="token function">which</span> to listen <span class="token keyword">for</span> the --secure-port port. The associated interface<span class="token punctuation">(</span>s<span class="token punctuation">)</span> must be reachable by the rest of the cluster, and by CLI/web clients. If blank, all interfaces will be used <span class="token punctuation">(</span>0.0.0.0 <span class="token keyword">for</span> all IPv4 interfaces and :: <span class="token keyword">for</span> all IPv6 interfaces<span class="token punctuation">)</span>. <span class="token punctuation">(</span>default 0.0.0.0<span class="token punctuation">)</span>
      --cert-dir string                                         The directory where the TLS certs are located. If --tls-cert-file and --tls-private-key-file are provided, this flag will be ignored. <span class="token punctuation">(</span>default <span class="token string">&quot;apiserver.local.config/certificates&quot;</span><span class="token punctuation">)</span>
      --client-ca-file string                                   If set, any request presenting a client certificate signed by one of the authorities <span class="token keyword">in</span> the client-ca-file is authenticated with an identity corresponding to the CommonName of the client certificate.
      --contention-profiling                                    Enable lock contention profiling, <span class="token keyword">if</span> profiling is enabled
      --enable-swagger-ui                                       Enables swagger ui on the apiserver at /swagger-ui
  -h, --help                                                    <span class="token function">help</span> <span class="token keyword">for</span> this <span class="token function">command</span>
      --http2-max-streams-per-connection int                    The limit that the server gives to clients <span class="token keyword">for</span> the maximum number of streams <span class="token keyword">in</span> an HTTP/2 connection. Zero means to use golang<span class="token string">'s default.
      --kubeconfig string                                       The path to the kubeconfig used to connect to the Kubernetes API server and the Kubelets (defaults to in-cluster config)
      --kubelet-insecure-tls                                    Do not verify CA of serving certificates presented by Kubelets.  For testing purposes only.
      --kubelet-port int                                        The port to use to connect to Kubelets (defaults to 10250) (default 10250)
      --kubelet-preferred-address-types strings                 The priority of node address types to use when determining which address to use to connect to a particular node (default [Hostname,InternalDNS,InternalIP,ExternalDNS,ExternalIP])
      --log-flush-frequency duration                            Maximum number of seconds between log flushes (default 5s)
      --log_backtrace_at traceLocation                          when logging hits line file:N, emit a stack trace (default :0)
      --log_dir string                                          If non-empty, write log files in this directory
      --logtostderr                                             log to standard error instead of files (default true)
      --metric-resolution duration                              The resolution at which metrics-server will retain metrics. (default 1m0s)
      --profiling                                               Enable profiling via web interface host:port/debug/pprof/ (default true)
      --requestheader-allowed-names strings                     List of client certificate common names to allow to provide usernames in headers specified by --requestheader-username-headers. If empty, any client certificate validated by the authorities in --requestheader-client-ca-file is allowed.
      --requestheader-client-ca-file string                     Root certificate bundle to use to verify client certificates on incoming requests before trusting usernames in headers specified by --requestheader-username-headers. WARNING: generally do not depend on authorization being already done for incoming requests.
      --requestheader-extra-headers-prefix strings              List of request header prefixes to inspect. X-Remote-Extra- is suggested. (default [x-remote-extra-])
      --requestheader-group-headers strings                     List of request headers to inspect for groups. X-Remote-Group is suggested. (default [x-remote-group])
      --requestheader-username-headers strings                  List of request headers to inspect for usernames. X-Remote-User is common. (default [x-remote-user])
      --secure-port int                                         The port on which to serve HTTPS with authentication and authorization. If 0, don'</span>t serve HTTPS at all. <span class="token punctuation">(</span>default 443<span class="token punctuation">)</span>
      --stderrthreshold severity                                logs at or above this threshold go to stderr <span class="token punctuation">(</span>default 2<span class="token punctuation">)</span>
      --tls-cert-file string                                    File containing the default x509 Certificate <span class="token keyword">for</span> HTTPS. <span class="token punctuation">(</span>CA cert, <span class="token keyword">if</span> any, concatenated after server cert<span class="token punctuation">)</span>. If HTTPS serving is enabled, and --tls-cert-file and --tls-private-key-file are not provided, a self-signed certificate and key are generated <span class="token keyword">for</span> the public address and saved to the directory specified by --cert-dir.
      --tls-cipher-suites strings                               Comma-separated list of cipher suites <span class="token keyword">for</span> the server. If omitted, the default Go cipher suites will be use.  Possible values: TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_RC4_128_SHA,TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_RC4_128_SHA,TLS_RSA_WITH_3DES_EDE_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_128_GCM_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_RC4_128_SHA
      --tls-min-version string                                  Minimum TLS version supported. Possible values: VersionTLS10, VersionTLS11, VersionTLS12
      --tls-private-key-file string                             File containing the default x509 private key matching --tls-cert-file.
      --tls-sni-cert-key namedCertKey                           A pair of x509 certificate and private key <span class="token function">file</span> paths, optionally suffixed with a list of domain patterns <span class="token function">which</span> are fully qualified domain names, possibly with prefixed wildcard segments. If no domain patterns are provided, the names of the certificate are extracted. Non-wildcard matches trump over wildcard matches, explicit domain patterns trump over extracted names. For multiple key/certificate pairs, use the --tls-sni-cert-key multiple times. Examples: <span class="token string">&quot;example.crt,example.key&quot;</span> or <span class="token string">&quot;foo.crt,foo.key:*.foo.com,foo.com&quot;</span><span class="token keyword">.</span> <span class="token punctuation">(</span>default <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  -v, --v Level                                                 log level <span class="token keyword">for</span> V logs
      --vmodule moduleSpec                                      comma-separated list of pattern<span class="token operator">=</span>N settings <span class="token keyword">for</span> file-filtered logging
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/addons/efk.html" class="prev">
          EFK 插件
        </a></span> <span class="next"><a href="/addons/prometheus-operator.html">
          Prometheus Operator
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.782518ec.js" defer></script><script src="/assets/js/9.cba53891.js" defer></script>
  </body>
</html>
